{{ 'section-product-detail-carousel.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .product-detail-carousel {
    height: 100vh;
    display: flex;
    overflow: hidden;
  }

  .product-detail-carousel__left {
    flex: 1;
    padding: 40px;
    overflow-y: auto;
    background: #f8f9fa;
    /* Hide scrollbar for Chrome, Safari and Opera */
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* Internet Explorer 10+ */
  }

  .product-detail-carousel__left::-webkit-scrollbar {
    display: none; /* WebKit browsers */
  }

  .product-detail-carousel__right {
    flex: 1;
    position: relative;
    background: #fff;
  }

  /* Section 1: Product Info */
  .product-info-section {
    margin-bottom: 40px;
  }

  .product-badge {
    background: #e32402;
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    display: inline-block;
    margin-bottom: 15px;
  }

  .product-title {
    font-size: 2.2rem;
    font-weight: 700;
    color: #e32402;
    margin-bottom: 20px;
    line-height: 1.2;
  }

  .product-pricing {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
  }

  .current-price {
    font-size: 2rem;
    font-weight: 700;
    color: #000;
  }

  .original-price {
    font-size: 1.2rem;
    color: #999;
    text-decoration: line-through;
  }

  .discount {
    background: #28a745;
    color: white;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.9rem;
    font-weight: 600;
  }

  .tax-info {
    font-size: 0.9rem;
    color: #666;
    margin-bottom: 15px;
  }

  .product-rating {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
  }

  .stars {
    color: #ffc107;
    font-size: 1.2rem;
  }

  .review-count {
    color: #666;
    font-size: 0.9rem;
  }

  .product-description {
    font-size: 1rem;
    color: #555;
    line-height: 1.6;
    margin-bottom: 20px;
  }

  .read-more {
    color: #e32402;
    text-decoration: underline;
    cursor: pointer;
  }

  .points-button {
    background: #e32402;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 6px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 30px;
    cursor: pointer;
  }

  .points-icon {
    width: 16px;
    height: 16px;
  }

  .nutrition-highlights {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
  }

  .nutrition-item {
    flex: 1;
    text-align: center;
    padding: 15px;
    border-right: 1px solid #eee;
  }

  .nutrition-item:last-child {
    border-right: none;
  }

  .nutrition-icon {
    width: 30px;
    height: 30px;
    margin: 0 auto 8px;
    background: #e32402;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
  }

  .nutrition-text {
    font-size: 0.9rem;
    font-weight: 600;
    color: #333;
  }

  /* Section 2: Product Tabs */
  .product-tabs-section {
    margin-bottom: 40px;
  }

  .tabs-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #333;
    margin-bottom: 20px;
  }

  .product-tabs {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
  }

  .product-tab {
    border: 2px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
  }

  .product-tab:hover {
    border-color: #e32402;
  }

  .product-tab.active {
    border-color: #e32402;
    background: #fff5f5;
  }

  .tab-image {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 4px;
    margin: 0 auto 10px;
    display: block;
  }

  .tab-name {
    font-size: 0.9rem;
    font-weight: 600;
    color: #333;
  }

  /* Section 3: Additional Content */
  .additional-content-section {
    margin-bottom: 40px;
  }

  .additional-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #333;
    margin-bottom: 15px;
  }

  .additional-text {
    font-size: 1rem;
    color: #555;
    line-height: 1.6;
  }

  /* Right Side - Image Carousel */
  .product-detail-carousel__image-container {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  .product-detail-carousel__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: opacity 0.5s ease;
  }

  .product-detail-carousel__image.active {
    opacity: 1;
  }

  .product-detail-carousel__image:not(.active) {
    opacity: 0;
    position: absolute;
    top: 0;
    left: 0;
  }

  .product-detail-carousel__nav {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
  }

  .product-detail-carousel__nav-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    border: 2px solid #fff;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .product-detail-carousel__nav-dot.active {
    background: #e32402;
    border-color: #e32402;
  }

  .product-detail-carousel__nav-arrows {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.5);
    color: white;
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    transition: all 0.3s ease;
  }

  .product-detail-carousel__nav-arrows:hover {
    background: rgba(0, 0, 0, 0.7);
  }

  .product-detail-carousel__nav-prev {
    left: 20px;
  }

  .product-detail-carousel__nav-next {
    right: 20px;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .product-detail-carousel {
      flex-direction: column;
      height: auto;
    }

    .product-detail-carousel__left {
      height: 50vh;
      padding: 20px;
    }

    .product-detail-carousel__right {
      height: 50vh;
    }

    .product-tabs {
      grid-template-columns: repeat(2, 1fr);
    }

    .nutrition-highlights {
      flex-direction: column;
      gap: 10px;
    }

    .nutrition-item {
      border-right: none;
      border-bottom: 1px solid #eee;
    }

    .nutrition-item:last-child {
      border-bottom: none;
    }
  }
{%- endstyle -%}

<div class="product-detail-carousel">
  <!-- Left Side - Scrollable Content -->
  <div class="product-detail-carousel__left">
    <!-- Section 1: Product Information -->
    <div class="product-info-section">
      {% if section.settings.badge_text != blank %}
        <div class="product-badge">{{ section.settings.badge_text }}</div>
      {% endif %}
      
      {% if section.settings.product_title != blank %}
        <h1 class="product-title">{{ section.settings.product_title }}</h1>
      {% endif %}
      
      <div class="product-pricing">
        {% if section.settings.current_price != blank %}
          <span class="current-price">{{ section.settings.current_price }}</span>
        {% endif %}
        {% if section.settings.original_price != blank %}
          <span class="original-price">{{ section.settings.original_price }}</span>
        {% endif %}
        {% if section.settings.discount_percent != blank %}
          <span class="discount">{{ section.settings.discount_percent }}</span>
        {% endif %}
      </div>
      
      {% if section.settings.tax_info != blank %}
        <div class="tax-info">{{ section.settings.tax_info }}</div>
      {% endif %}
      
      <div class="product-rating">
        <div class="stars">★★★★☆</div>
        <span class="review-count">| {{ section.settings.review_count | default: "78 Reviews" }}</span>
      </div>
      
      {% if section.settings.product_description != blank %}
        <div class="product-description">
          {{ section.settings.product_description }}
          <span class="read-more">Read more</span>
        </div>
      {% endif %}
      
      {% if section.settings.points_text != blank %}
        <button class="points-button">
          <span class="points-icon">★</span>
          {{ section.settings.points_text }}
          <span class="points-icon">i</span>
        </button>
      {% endif %}
      
      <div class="nutrition-highlights">
        <div class="nutrition-item">
          <div class="nutrition-icon">P</div>
          <div class="nutrition-text">{{ section.settings.nutrition_1 | default: "24g Protein" }}</div>
        </div>
        <div class="nutrition-item">
          <div class="nutrition-icon">B</div>
          <div class="nutrition-text">{{ section.settings.nutrition_2 | default: "5g BCAA" }}</div>
        </div>
        <div class="nutrition-item">
          <div class="nutrition-icon">E</div>
          <div class="nutrition-text">{{ section.settings.nutrition_3 | default: "ALL 9 EAAs" }}</div>
        </div>
      </div>
    </div>

    <!-- Section 2: Product Tabs -->
    <div class="product-tabs-section">
      <h2 class="tabs-title">Select Your Pack</h2>
      <div class="product-tabs">
        {% for i in (1..6) %}
          {% assign tab_image_key = 'tab_' | append: i | append: '_image' %}
          {% assign tab_name_key = 'tab_' | append: i | append: '_name' %}
          {% assign tab_images_key = 'tab_' | append: i | append: '_images' %}
          
          <div class="product-tab {% if forloop.first %}active{% endif %}" 
               data-tab="{{ i }}" 
               data-images="{{ section.settings[tab_images_key] }}"
               onclick="switchProductTab({{ i }})">
            {% if section.settings[tab_image_key] != blank %}
              <img src="{{ section.settings[tab_image_key] | image_url: width: 160 }}" 
                   alt="{{ section.settings[tab_name_key] | default: 'Product ' | append: i }}"
                   class="tab-image">
            {% endif %}
            <div class="tab-name">{{ section.settings[tab_name_key] | default: 'Product ' | append: i }}</div>
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- Section 3: Additional Content -->
    <div class="additional-content-section">
      {% if section.settings.additional_title != blank %}
        <h2 class="additional-title">{{ section.settings.additional_title }}</h2>
      {% endif %}
      {% if section.settings.additional_text != blank %}
        <div class="additional-text">{{ section.settings.additional_text }}</div>
      {% endif %}
    </div>
  </div>

  <!-- Right Side - Image Carousel -->
  <div class="product-detail-carousel__right">
    <div class="product-detail-carousel__image-container">
      {% if section.settings.image_1 != blank %}
        <img 
          src="{{ section.settings.image_1 | image_url: width: 800 }}"
          alt="{{ section.settings.image_1.alt | escape }}"
          class="product-detail-carousel__image active"
          loading="lazy"
        >
      {% endif %}
      
      {% if section.settings.image_2 != blank %}
        <img 
          src="{{ section.settings.image_2 | image_url: width: 800 }}"
          alt="{{ section.settings.image_2.alt | escape }}"
          class="product-detail-carousel__image"
          loading="lazy"
        >
      {% endif %}
      
      <!-- Navigation Arrows -->
      <button class="product-detail-carousel__nav-arrows product-detail-carousel__nav-prev" onclick="changeSlide(-1)">
        ‹
      </button>
      <button class="product-detail-carousel__nav-arrows product-detail-carousel__nav-next" onclick="changeSlide(1)">
        ›
      </button>
      
      <!-- Navigation Dots -->
      <div class="product-detail-carousel__nav">
        <span class="product-detail-carousel__nav-dot active" onclick="currentSlide(1)"></span>
        <span class="product-detail-carousel__nav-dot" onclick="currentSlide(2)"></span>
      </div>
    </div>
  </div>
</div>

<script>
  let currentSlideIndex = 0;
  let currentTab = 1;
  let slides = document.querySelectorAll('.product-detail-carousel__image');
  let dots = document.querySelectorAll('.product-detail-carousel__nav-dot');

  // Product images data for each tab
  const productImages = {
    1: [
      {% if section.settings.tab_1_images != blank %}
        {% assign images = section.settings.tab_1_images | split: ',' %}
        {% for image in images %}
          "{{ image | strip }}",
        {% endfor %}
      {% endif %}
    ],
    2: [
      {% if section.settings.tab_2_images != blank %}
        {% assign images = section.settings.tab_2_images | split: ',' %}
        {% for image in images %}
          "{{ image | strip }}",
        {% endfor %}
      {% endif %}
    ],
    3: [
      {% if section.settings.tab_3_images != blank %}
        {% assign images = section.settings.tab_3_images | split: ',' %}
        {% for image in images %}
          "{{ image | strip }}",
        {% endfor %}
      {% endif %}
    ],
    4: [
      {% if section.settings.tab_4_images != blank %}
        {% assign images = section.settings.tab_4_images | split: ',' %}
        {% for image in images %}
          "{{ image | strip }}",
        {% endfor %}
      {% endif %}
    ],
    5: [
      {% if section.settings.tab_5_images != blank %}
        {% assign images = section.settings.tab_5_images | split: ',' %}
        {% for image in images %}
          "{{ image | strip }}",
        {% endfor %}
      {% endif %}
    ],
    6: [
      {% if section.settings.tab_6_images != blank %}
        {% assign images = section.settings.tab_6_images | split: ',' %}
        {% for image in images %}
          "{{ image | strip }}",
        {% endfor %}
      {% endif %}
    ]
  };

  function switchProductTab(tabNumber) {
    // Update active tab
    document.querySelectorAll('.product-tab').forEach(tab => {
      tab.classList.remove('active');
    });
    document.querySelector(`[data-tab="${tabNumber}"]`).classList.add('active');
    
    currentTab = tabNumber;
    updateCarouselImages();
  }

  function updateCarouselImages() {
    const images = productImages[currentTab] || [];
    const container = document.querySelector('.product-detail-carousel__image-container');
    
    // Clear existing images
    container.innerHTML = '';
    
    // Add navigation arrows
    container.innerHTML += `
      <button class="product-detail-carousel__nav-arrows product-detail-carousel__nav-prev" onclick="changeSlide(-1)">‹</button>
      <button class="product-detail-carousel__nav-arrows product-detail-carousel__nav-next" onclick="changeSlide(1)">›</button>
    `;
    
    // Add images
    images.forEach((imageUrl, index) => {
      const img = document.createElement('img');
      img.src = imageUrl;
      img.alt = `Product ${currentTab} Image ${index + 1}`;
      img.className = `product-detail-carousel__image ${index === 0 ? 'active' : ''}`;
      img.loading = 'lazy';
      container.appendChild(img);
    });
    
    // Add navigation dots
    if (images.length > 1) {
      const navContainer = document.createElement('div');
      navContainer.className = 'product-detail-carousel__nav';
      
      images.forEach((_, index) => {
        const dot = document.createElement('span');
        dot.className = `product-detail-carousel__nav-dot ${index === 0 ? 'active' : ''}`;
        dot.onclick = () => currentSlide(index + 1);
        navContainer.appendChild(dot);
      });
      
      container.appendChild(navContainer);
    }
    
    // Update global references
    slides = document.querySelectorAll('.product-detail-carousel__image');
    dots = document.querySelectorAll('.product-detail-carousel__nav-dot');
    currentSlideIndex = 0;
  }

  function showSlide(index) {
    // Hide all slides
    slides.forEach(slide => slide.classList.remove('active'));
    dots.forEach(dot => dot.classList.remove('active'));
    
    // Show current slide
    if (slides[index]) {
      slides[index].classList.add('active');
    }
    if (dots[index]) {
      dots[index].classList.add('active');
    }
  }

  function changeSlide(direction) {
    if (slides.length === 0) return;
    
    currentSlideIndex += direction;
    
    if (currentSlideIndex >= slides.length) {
      currentSlideIndex = 0;
    } else if (currentSlideIndex < 0) {
      currentSlideIndex = slides.length - 1;
    }
    
    showSlide(currentSlideIndex);
  }

  function currentSlide(index) {
    currentSlideIndex = index - 1;
    showSlide(currentSlideIndex);
  }

  // Initialize with first tab
  document.addEventListener('DOMContentLoaded', function() {
    updateCarouselImages();
  });
</script>

{% schema %}
{
  "name": "Product Detail Carousel",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Section 1: Product Information"
    },
    {
      "type": "text",
      "id": "badge_text",
      "label": "Badge Text",
      "default": "NEW LAUNCH"
    },
    {
      "type": "text",
      "id": "product_title",
      "label": "Product Title",
      "default": "COLD COFFEE 1 KG - FERMENTED YEAST PROTEIN"
    },
    {
      "type": "text",
      "id": "current_price",
      "label": "Current Price",
      "default": "Rs. 2,799"
    },
    {
      "type": "text",
      "id": "original_price",
      "label": "Original Price",
      "default": "Rs. 3,200"
    },
    {
      "type": "text",
      "id": "discount_percent",
      "label": "Discount Percentage",
      "default": "-13% OFF"
    },
    {
      "type": "text",
      "id": "tax_info",
      "label": "Tax Information",
      "default": "Incl. of all taxes & shipping"
    },
    {
      "type": "text",
      "id": "review_count",
      "label": "Review Count",
      "default": "78 Reviews"
    },
    {
      "type": "richtext",
      "id": "product_description",
      "label": "Product Description",
      "default": "<p>Love your brew? This one's for you. A cold coffee flavour that actually tastes like a frothy coffee with no artificial flavours.</p>"
    },
    {
      "type": "text",
      "id": "points_text",
      "label": "Points Text",
      "default": "Earn upto 279 Points on this purchase"
    },
    {
      "type": "text",
      "id": "nutrition_1",
      "label": "Nutrition 1",
      "default": "24g Protein"
    },
    {
      "type": "text",
      "id": "nutrition_2",
      "label": "Nutrition 2",
      "default": "5g BCAA"
    },
    {
      "type": "text",
      "id": "nutrition_3",
      "label": "Nutrition 3",
      "default": "ALL 9 EAAs"
    },
    {
      "type": "header",
      "content": "Section 2: Product Tabs"
    },
    {
      "type": "image_picker",
      "id": "tab_1_image",
      "label": "Tab 1 - Image"
    },
    {
      "type": "text",
      "id": "tab_1_name",
      "label": "Tab 1 - Name",
      "default": "1kg - Chocolate"
    },
    {
      "type": "textarea",
      "id": "tab_1_images",
      "label": "Tab 1 - Carousel Images (comma separated URLs)",
      "info": "Enter image URLs separated by commas"
    },
    {
      "type": "image_picker",
      "id": "tab_2_image",
      "label": "Tab 2 - Image"
    },
    {
      "type": "text",
      "id": "tab_2_name",
      "label": "Tab 2 - Name",
      "default": "1kg - Cold Coffee"
    },
    {
      "type": "textarea",
      "id": "tab_2_images",
      "label": "Tab 2 - Carousel Images (comma separated URLs)",
      "info": "Enter image URLs separated by commas"
    },
    {
      "type": "image_picker",
      "id": "tab_3_image",
      "label": "Tab 3 - Image"
    },
    {
      "type": "text",
      "id": "tab_3_name",
      "label": "Tab 3 - Name",
      "default": "1kg - Unflavoured"
    },
    {
      "type": "textarea",
      "id": "tab_3_images",
      "label": "Tab 3 - Carousel Images (comma separated URLs)",
      "info": "Enter image URLs separated by commas"
    },
    {
      "type": "image_picker",
      "id": "tab_4_image",
      "label": "Tab 4 - Image"
    },
    {
      "type": "text",
      "id": "tab_4_name",
      "label": "Tab 4 - Name",
      "default": "Travel Pack - Chocolate"
    },
    {
      "type": "textarea",
      "id": "tab_4_images",
      "label": "Tab 4 - Carousel Images (comma separated URLs)",
      "info": "Enter image URLs separated by commas"
    },
    {
      "type": "image_picker",
      "id": "tab_5_image",
      "label": "Tab 5 - Image"
    },
    {
      "type": "text",
      "id": "tab_5_name",
      "label": "Tab 5 - Name",
      "default": "Travel Pack - Cold Coffee"
    },
    {
      "type": "textarea",
      "id": "tab_5_images",
      "label": "Tab 5 - Carousel Images (comma separated URLs)",
      "info": "Enter image URLs separated by commas"
    },
    {
      "type": "image_picker",
      "id": "tab_6_image",
      "label": "Tab 6 - Image"
    },
    {
      "type": "text",
      "id": "tab_6_name",
      "label": "Tab 6 - Name",
      "default": "Travel Pack - Assorted"
    },
    {
      "type": "textarea",
      "id": "tab_6_images",
      "label": "Tab 6 - Carousel Images (comma separated URLs)",
      "info": "Enter image URLs separated by commas"
    },
    {
      "type": "header",
      "content": "Section 3: Additional Content"
    },
    {
      "type": "text",
      "id": "additional_title",
      "label": "Additional Title",
      "default": "Why Choose Our Product?"
    },
    {
      "type": "richtext",
      "id": "additional_text",
      "label": "Additional Text",
      "default": "<p>Experience the difference with our premium product. Join thousands of satisfied customers who have made the switch to quality.</p>"
    }
  ],
  "presets": [
    {
      "name": "Product Detail Carousel"
    }
  ]
}
{% endschema %}
