{% comment %}
  AI Generated Block: Reviews Section
  Features: Masonry layout with 4 columns, dynamic card placement
{% endcomment %}

{%- assign ai_gen_id = block.id | slice: -8 -%}

<div class="reviews-section-{{ ai_gen_id }}">
  <div class="reviews-container-{{ ai_gen_id }}">
    <div class="reviews-header-{{ ai_gen_id }}">
      <div class="reviews-title-section-{{ ai_gen_id }}">
        {% if block.settings.section_title != blank %}
          <h2 class="reviews-title-{{ ai_gen_id }}">{{ block.settings.section_title }}</h2>
        {% endif %}
        {% if block.settings.section_subtitle != blank %}
          <p class="reviews-subtitle-{{ ai_gen_id }}">{{ block.settings.section_subtitle }}</p>
        {% endif %}
      </div>
      <div class="reviews-header-content-{{ ai_gen_id }}">
        <button class="add-review-btn-{{ ai_gen_id }}" id="add-review-btn-{{ ai_gen_id }}">
          Write A Review
        </button>
      </div>
    </div>
    
    <div class="reviews-grid-{{ ai_gen_id }}" id="reviews-grid-{{ ai_gen_id }}">
      <!-- Reviews will be dynamically added here by JavaScript -->
    </div>
    
    <div class="reviews-pagination-{{ ai_gen_id }}" id="reviews-pagination-{{ ai_gen_id }}" style="display: none;">
      <button class="view-more-btn-{{ ai_gen_id }}" id="view-more-btn-{{ ai_gen_id }}">
        View More Reviews
      </button>
    </div>
  </div>
</div>

<!-- Write A Review Modal -->
<div class="review-modal-overlay-{{ ai_gen_id }}" id="review-modal-overlay-{{ ai_gen_id }}">
  <div class="review-modal-{{ ai_gen_id }}" id="review-modal-{{ ai_gen_id }}">
    <div class="review-modal-header-{{ ai_gen_id }}">
      <h3 class="review-modal-title-{{ ai_gen_id }}">Write A Review</h3>
      <button class="review-modal-close-{{ ai_gen_id }}" id="review-modal-close-{{ ai_gen_id }}">√ó</button>
    </div>
    
    <!-- First Page -->
    <div class="review-modal-content-{{ ai_gen_id }}" id="review-page-1-{{ ai_gen_id }}">
      <div class="review-points-info-{{ ai_gen_id }}">
        <p>You will receive <strong>60 Points</strong> for leaving a review. You will be rewarded for upto 1 review per month.</p>
      </div>
      
      <div class="review-experience-section-{{ ai_gen_id }}">
        <h4 class="review-experience-title-{{ ai_gen_id }}">How was your experience?</h4>
        <p class="review-experience-desc-{{ ai_gen_id }}">Your feedback is valuable in helping us better understand your needs and tailor our service accordingly.</p>
      </div>
      
      <div class="review-emoji-rating-{{ ai_gen_id }}">
        <div class="emoji-option-{{ ai_gen_id }}" data-rating="1">üòû</div>
        <div class="emoji-option-{{ ai_gen_id }}" data-rating="2">üòï</div>
        <div class="emoji-option-{{ ai_gen_id }}" data-rating="3">üòê</div>
        <div class="emoji-option-{{ ai_gen_id }}" data-rating="4">üòä</div>
        <div class="emoji-option-{{ ai_gen_id }} selected" data-rating="5">üòç</div>
      </div>
      
      <div class="review-text-section-{{ ai_gen_id }}">
        <textarea 
          class="review-textarea-{{ ai_gen_id }}" 
          id="review-textarea-{{ ai_gen_id }}"
          placeholder="Share your experience using this product"
          rows="4"
        ></textarea>
      </div>
      
      <div class="review-modal-actions-{{ ai_gen_id }}">
        <button class="review-next-btn-{{ ai_gen_id }}" id="review-next-btn-{{ ai_gen_id }}">
          Next
        </button>
      </div>
    </div>

    <!-- Second Page -->
    <div class="review-modal-content-{{ ai_gen_id }}" id="review-page-2-{{ ai_gen_id }}" style="display: none;">
      <div class="review-points-info-{{ ai_gen_id }}">
        <p>You will receive <strong>60 Points</strong> for leaving a review. You will be rewarded for upto 1 review per month.</p>
      </div>
      
      <div class="review-form-section-{{ ai_gen_id }}">
        <div class="review-form-field-{{ ai_gen_id }}">
          <label class="review-form-label-{{ ai_gen_id }}" for="review-name-{{ ai_gen_id }}">
            Name <span class="required-asterisk-{{ ai_gen_id }}">*</span>
          </label>
          <input 
            type="text" 
            class="review-form-input-{{ ai_gen_id }}" 
            id="review-name-{{ ai_gen_id }}"
            placeholder="Enter your name"
            required
          >
        </div>
        
        <div class="review-form-field-{{ ai_gen_id }}">
          <label class="review-form-label-{{ ai_gen_id }}" for="review-email-{{ ai_gen_id }}">
            Email <span class="required-asterisk-{{ ai_gen_id }}">*</span>
          </label>
          <input 
            type="email" 
            class="review-form-input-{{ ai_gen_id }}" 
            id="review-email-{{ ai_gen_id }}"
            placeholder="Enter your email"
            required
          >
        </div>
      </div>
      
      <div class="review-upload-bonus-{{ ai_gen_id }}">
        <p>* Upload an image and receive a 1.5X bonus!</p>
      </div>
      
      <div class="review-upload-section-{{ ai_gen_id }}">
        <div class="upload-option-{{ ai_gen_id }}" id="upload-images-{{ ai_gen_id }}">
          <div class="upload-icon-{{ ai_gen_id }}">üì∑</div>
          <div class="upload-text-{{ ai_gen_id }}">
            <div class="upload-title-{{ ai_gen_id }}">Upload Images</div>
            <div class="upload-subtitle-{{ ai_gen_id }}">You can upload upto 5 images</div>
          </div>
          <input type="file" id="image-upload-{{ ai_gen_id }}" multiple accept="image/*" style="display: none;">
        </div>
        
        <div class="upload-option-{{ ai_gen_id }}" id="upload-video-{{ ai_gen_id }}">
          <div class="upload-icon-{{ ai_gen_id }}">üé•</div>
          <div class="upload-text-{{ ai_gen_id }}">
            <div class="upload-title-{{ ai_gen_id }}">Upload Video</div>
            <div class="upload-subtitle-{{ ai_gen_id }}">Max Limit 50 MB</div>
          </div>
          <input type="file" id="video-upload-{{ ai_gen_id }}" accept="video/*" style="display: none;">
        </div>
      </div>
      
      <div class="review-modal-actions-{{ ai_gen_id }}">
        <button class="review-back-btn-{{ ai_gen_id }}" id="review-back-btn-{{ ai_gen_id }}">
          ‚Üê Back
        </button>
        <button class="review-submit-btn-{{ ai_gen_id }}" id="review-submit-btn-{{ ai_gen_id }}">
          Submit
        </button>
      </div>
    </div>
  </div>
</div>

{% style %}
  .reviews-section-{{ ai_gen_id }} {
    background-color: {{ block.settings.background_color | default: '#f8f9fa' }};
    padding: 4rem 0;
  }

  .reviews-container-{{ ai_gen_id }} {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
  }

  .reviews-header-{{ ai_gen_id }} {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
  }

  .reviews-title-section-{{ ai_gen_id }} {
    flex: 1;
  }

  .reviews-title-{{ ai_gen_id }} {
    font-size: 2.5rem;
    font-weight: 700;
    color: {{ block.settings.title_color | default: '#333' }};
    text-align: left;
    margin: 0 0 0.5rem 0;
  }

  .reviews-subtitle-{{ ai_gen_id }} {
    font-size: 1.1rem;
    color: {{ block.settings.subtitle_color | default: '#666' }};
    text-align: left;
    max-width: 600px;
    margin: 0;
  }

  .reviews-header-content-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
  }

  .add-review-btn-{{ ai_gen_id }} {
    background: #e32402;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .add-review-btn-{{ ai_gen_id }}:hover {
    background: #c01e02;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(227, 36, 2, 0.3);
  }

  .add-review-btn-{{ ai_gen_id }}:active {
    transform: translateY(0);
  }

  .reviews-grid-{{ ai_gen_id }} {
    display: flex;
    gap: 1.5rem;
    align-items: flex-start;
  }

  .reviews-column-{{ ai_gen_id }} {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .review-card-{{ ai_gen_id }} {
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    break-inside: avoid;
    margin-bottom: 1.5rem;
    display: flex;
    flex-direction: column;
  }

  .review-card-{{ ai_gen_id }}:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  }

  .review-product-image-{{ ai_gen_id }} {
    width: 100%;
    {% comment %} height: 200px; {% endcomment %}
    object-fit: cover;
  }

  .review-content-{{ ai_gen_id }} {
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .review-card-no-image-{{ ai_gen_id }} .review-content-{{ ai_gen_id }} {
    padding: 1.5rem;
  }

  .review-name-{{ ai_gen_id }} {
    font-size: 1rem;
    font-weight: 600;
    color: {{ block.settings.name_color | default: '#333' }};
    margin: 0;
    text-transform: capitalize;
  }

  .review-stars-{{ ai_gen_id }} {
    display: flex;
    gap: 2px;
    margin: 0;
  }

  .review-star-{{ ai_gen_id }} {
    width: 16px;
    height: 16px;
    fill: #e32402;
  }

  .review-star-empty-{{ ai_gen_id }} {
    width: 16px;
    height: 16px;
    fill: none;
    stroke: #ddd;
    stroke-width: 1.5;
  }

  .review-comment-{{ ai_gen_id }} {
    color: {{ block.settings.comment_color | default: '#333' }};
    line-height: 1.5;
    margin: 0;
    font-size: 12px;
    font-weight: 400;
    color: #000000b3;
  }

  .review-date-{{ ai_gen_id }} {
    font-size: 0.85rem;
    color: #999;
    margin: 0;
  }

  .reviews-pagination-{{ ai_gen_id }} {
    text-align: center;
    margin-top: 3rem;
  }

  .view-more-btn-{{ ai_gen_id }} {
    background: #e32402;
    color: white;
    border: none;
    padding: 12px 30px;
    border-radius: 25px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .view-more-btn-{{ ai_gen_id }}:hover {
    background: #c01e02;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(227, 36, 2, 0.3);
  }

  .view-more-btn-{{ ai_gen_id }}:active {
    transform: translateY(0);
  }

  /* Review Modal Styles */
  .review-modal-overlay-{{ ai_gen_id }} {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  .review-modal-overlay-{{ ai_gen_id }}.active {
    display: flex;
  }

  .review-modal-{{ ai_gen_id }} {
    background: white;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  }

  .review-modal-header-{{ ai_gen_id }} {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 1.5rem 0 1.5rem;
    border-bottom: 1px solid #eee;
    margin-bottom: 1.5rem;
  }

  .review-modal-title-{{ ai_gen_id }} {
    font-size: 1.8rem;
    font-weight: 700;
    color: #333;
    margin: 0;
  }

  .review-modal-close-{{ ai_gen_id }} {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #666;
    cursor: pointer;
    padding: 0.5rem;
    line-height: 1;
  }

  .review-modal-close-{{ ai_gen_id }}:hover {
    color: #333;
  }

  .review-modal-content-{{ ai_gen_id }} {
    padding: 0 1.5rem 1.5rem 1.5rem;
  }

  .review-points-info-{{ ai_gen_id }} {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
  }

  .review-points-info-{{ ai_gen_id }} p {
    margin: 0;
    color: #000000b3;
    font-size: 12px;
    font-weight: 400;
  }

  .review-experience-section-{{ ai_gen_id }} {
    margin-bottom: 1.5rem;
  }

  .review-experience-title-{{ ai_gen_id }} {
    font-size: 1.1rem;
    font-weight: 600;
    color: #333;
    margin: 0 0 0.5rem 0;
  }

  .review-experience-desc-{{ ai_gen_id }} {
    color: #000000b3;
    font-size: 12px;
    font-weight: 400;
    margin: 0;
    line-height: 1.4;
  }

  .review-emoji-rating-{{ ai_gen_id }} {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .emoji-option-{{ ai_gen_id }} {
    font-size: 2.2rem;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 50%;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 55px;
    height: 55px;
  }

  .emoji-option-{{ ai_gen_id }}:hover {
    background: #f0f0f0;
  }

  .emoji-option-{{ ai_gen_id }}.selected {
    background: #e32402;
    transform: scale(1.1);
  }

  .review-text-section-{{ ai_gen_id }} {
    margin-bottom: 1.5rem;
  }

  .review-textarea-{{ ai_gen_id }} {
    width: 100% !important;
    padding: 1rem !important;
    border: 1px solid #ddd !important;
    border-radius: 8px !important;
    font-size: 14px !important;
    font-weight: 400 !important;
    color: #000000b3 !important;
    font-family: inherit !important;
    resize: vertical !important;
    min-height: 100px !important;
    outline: none !important;
    transition: border-color 0.3s ease !important;
    line-height: 1.5 !important;
  }

  .review-textarea-{{ ai_gen_id }}:focus {
    border-color: #e32402;
  }

  .review-textarea-{{ ai_gen_id }}::placeholder {
    color: #999;
  }

  .review-modal-actions-{{ ai_gen_id }} {
    display: flex;
    justify-content: flex-start;
  }

  .review-next-btn-{{ ai_gen_id }} {
    background: #e32402;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .review-next-btn-{{ ai_gen_id }}:hover {
    background: #c01e02;
    transform: translateY(-1px);
  }

  .review-next-btn-{{ ai_gen_id }}:active {
    transform: translateY(0);
  }

  /* Second Page Styles */
  .review-form-section-{{ ai_gen_id }} {
    margin-bottom: 1.5rem;
  }

  .review-form-field-{{ ai_gen_id }} {
    margin-bottom: 1rem;
  }

  .review-form-label-{{ ai_gen_id }} {
    display: block;
    font-size: 0.9rem;
    font-weight: 600;
    color: #333;
    margin-bottom: 0.5rem;
  }

  .required-asterisk-{{ ai_gen_id }} {
    color: #e32402;
  }

  .review-form-input-{{ ai_gen_id }} {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 1rem;
    font-family: inherit;
    outline: none;
    transition: border-color 0.3s ease;
  }

  .review-form-input-{{ ai_gen_id }}:focus {
    border-color: #e32402;
  }

  .review-form-input-{{ ai_gen_id }}::placeholder {
    color: #999;
  }

  .review-upload-bonus-{{ ai_gen_id }} {
    margin-bottom: 1rem;
  }

  .review-upload-bonus-{{ ai_gen_id }} p {
    margin: 0;
    color: #000000b3;
    font-size: 12px;
    font-weight: 400;
  }

  .review-upload-section-{{ ai_gen_id }} {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .upload-option-{{ ai_gen_id }} {
    flex: 1;
    border: 2px dashed #ddd;
    border-radius: 8px;
    padding: 1.5rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  .upload-option-{{ ai_gen_id }}:hover {
    border-color: #e32402;
    background: #fafafa;
  }

  .upload-icon-{{ ai_gen_id }} {
    font-size: 2rem;
    color: #e32402;
  }

  .upload-text-{{ ai_gen_id }} {
    text-align: center;
  }

  .upload-title-{{ ai_gen_id }} {
    font-size: 0.9rem;
    font-weight: 600;
    color: #333;
    margin-bottom: 0.25rem;
  }

  .upload-subtitle-{{ ai_gen_id }} {
    font-size: 12px;
    font-weight: 400;
    color: #000000b3;
  }

  .review-back-btn-{{ ai_gen_id }} {
    background: #f8f9fa;
    color: #333;
    border: 1px solid #ddd;
    padding: 12px 24px;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-right: 1rem;
  }

  .review-back-btn-{{ ai_gen_id }}:hover {
    background: #e9ecef;
    border-color: #ccc;
  }

  .review-submit-btn-{{ ai_gen_id }} {
    background: #e32402;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .review-submit-btn-{{ ai_gen_id }}:hover {
    background: #c01e02;
    transform: translateY(-1px);
  }

  .review-submit-btn-{{ ai_gen_id }}:active {
    transform: translateY(0);
  }

  /* Responsive Design */
  @media (max-width: 1024px) {
    .reviews-grid-{{ ai_gen_id }} {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (max-width: 768px) {
    .reviews-section-{{ ai_gen_id }} {
      padding: 3rem 0;
    }
    
    .reviews-container-{{ ai_gen_id }} {
      padding: 0 1rem;
    }
    
    .reviews-title-{{ ai_gen_id }} {
      font-size: 2rem;
    }
    
    .reviews-grid-{{ ai_gen_id }} {
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }
  }

  @media (max-width: 480px) {
    .reviews-grid-{{ ai_gen_id }} {
      grid-template-columns: 1fr;
    }
    
    .review-card-{{ ai_gen_id }} {
      padding: 1rem;
    }
  }
{% endstyle %}

<script>
document.addEventListener('DOMContentLoaded', function() {
  const grid = document.getElementById('reviews-grid-{{ ai_gen_id }}');
  const pagination = document.getElementById('reviews-pagination-{{ ai_gen_id }}');
  const viewMoreBtn = document.getElementById('view-more-btn-{{ ai_gen_id }}');
  
  if (!grid) return;

  // Review data from block settings
  const allReviews = [
    {% if block.settings.review_1_name != blank %}
    {
      name: "{{ block.settings.review_1_name }}",
      stars: {{ block.settings.review_1_stars | default: 5 }},
      comment: "{{ block.settings.review_1_comment }}",
      date: "{{ block.settings.review_1_date }}",
      image: "{{ block.settings.review_1_image  }}"
    },
    {% endif %}
    {% if block.settings.review_2_name != blank %}
    {
      name: "{{ block.settings.review_2_name }}",
      stars: {{ block.settings.review_2_stars | default: 5 }},
      comment: "{{ block.settings.review_2_comment }}",
      date: "{{ block.settings.review_2_date }}",
      image: "{{ block.settings.review_2_image  }}"
    },
    {% endif %}
    {% if block.settings.review_3_name != blank %}
    {
      name: "{{ block.settings.review_3_name }}",
      stars: {{ block.settings.review_3_stars | default: 5 }},
      comment: "{{ block.settings.review_3_comment }}",
      date: "{{ block.settings.review_3_date }}",
      image: "{{ block.settings.review_3_image  }}"
    },
    {% endif %}
    {% if block.settings.review_4_name != blank %}
    {
      name: "{{ block.settings.review_4_name }}",
      stars: {{ block.settings.review_4_stars | default: 5 }},
      comment: "{{ block.settings.review_4_comment }}",
      date: "{{ block.settings.review_4_date }}",
      image: "{{ block.settings.review_4_image  }}"
    },
    {% endif %}
    {% if block.settings.review_5_name != blank %}
    {
      name: "{{ block.settings.review_5_name }}",
      stars: {{ block.settings.review_5_stars | default: 5 }},
      comment: "{{ block.settings.review_5_comment }}",
      date: "{{ block.settings.review_5_date }}",
      image: "{% if block.settings.review_5_image != blank %}{{ block.settings.review_5_image  }}{% else %}https://cdn.nector.io/?image=https://cdn.nector.io/nector-static/system-upload/c04b9fac-06aa-4172-918c-167503bbe118.jpeg&quality=25{% endif %}"
    },
    {% endif %}
    {% if block.settings.review_6_name != blank %}
    {
      name: "{{ block.settings.review_6_name }}",
      stars: {{ block.settings.review_6_stars | default: 5 }},
      comment: "{{ block.settings.review_6_comment }}",
      date: "{{ block.settings.review_6_date }}",
      image: "{{ block.settings.review_6_image  }}"
    },
    {% endif %}
    {% if block.settings.review_7_name != blank %}
    {
      name: "{{ block.settings.review_7_name }}",
      stars: {{ block.settings.review_7_stars | default: 5 }},
      comment: "{{ block.settings.review_7_comment }}",
      date: "{{ block.settings.review_7_date }}",
      image: "{{ block.settings.review_7_image  }}"
    },
    {% endif %}
    {% if block.settings.review_8_name != blank %}
    {
      name: "{{ block.settings.review_8_name }}",
      stars: {{ block.settings.review_8_stars | default: 5 }},
      comment: "{{ block.settings.review_8_comment }}",
      date: "{{ block.settings.review_8_date }}",
      image: "{{ block.settings.review_8_image  }}"
    },
    {% endif %}
    {% if block.settings.review_8_name != blank %}
    {
      name: "{{ block.settings.review_8_name }}",
      stars: {{ block.settings.review_8_stars | default: 5 }},
      comment: "{{ block.settings.review_8_comment }}",
      date: "{{ block.settings.review_8_date }}",
      image: "{{ block.settings.review_8_image  }}"
    },
    {% endif %}
  ].filter(review => review.name); // Remove empty reviews

  // Pagination variables
  const reviewsPerPage = 8;
  let currentPage = 0;
  let displayedReviews = 0;

  function createReviewCard(review) {
    const card = document.createElement('div');
    card.className = `review-card-{{ ai_gen_id }}${!review.image ? ' review-card-no-image-{{ ai_gen_id }}' : ''}`;
    
    let starsHtml = '';
    for (let i = 0; i < 5; i++) {
      if (i < review.stars) {
        starsHtml += `<svg class="review-star-{{ ai_gen_id }}" viewBox="0 0 24 24">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>`;
      } else {
        starsHtml += `<svg class="review-star-empty-{{ ai_gen_id }}" viewBox="0 0 24 24">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>`;
      }
    }
    
    card.innerHTML = `
      ${review.image ? `<img src="${review.image}" alt="Product" class="review-product-image-{{ ai_gen_id }}">` : ''}
      <div class="review-content-{{ ai_gen_id }}">
        <h4 class="review-name-{{ ai_gen_id }}">${review.name}</h4>
        <div class="review-stars-{{ ai_gen_id }}">${starsHtml}</div>
        ${review.comment ? `<p class="review-comment-{{ ai_gen_id }}">${review.comment}</p>` : ''}
        ${review.date ? `<div class="review-date-{{ ai_gen_id }}">${review.date}</div>` : ''}
      </div>
    `;
    
    return card;
  }

  function initializeColumns() {
    // Create 4 columns
    for (let i = 0; i < 4; i++) {
      const column = document.createElement('div');
      column.className = 'reviews-column-{{ ai_gen_id }}';
      grid.appendChild(column);
    }
  }

  function getColumnHeights() {
    const columns = grid.children;
    const heights = [];
    for (let i = 0; i < columns.length; i++) {
      heights.push(columns[i].offsetHeight);
    }
    return heights;
  }

  function addReviewToShortestColumn(review) {
    const card = createReviewCard(review);
    
    // Find the column with minimum height
    const heights = getColumnHeights();
    const minHeight = Math.min(...heights);
    const minIndex = heights.indexOf(minHeight);
    
    // Add card to the shortest column
    grid.children[minIndex].appendChild(card);
  }

  function loadMoreReviews() {
    const startIndex = currentPage * reviewsPerPage;
    const endIndex = Math.min(startIndex + reviewsPerPage, allReviews.length);
    const reviewsToShow = allReviews.slice(startIndex, endIndex);
    
    reviewsToShow.forEach((review, index) => {
      setTimeout(() => {
        addReviewToShortestColumn(review);
        displayedReviews++;
        
        // Check if this was the last review to be added
        if (displayedReviews >= allReviews.length) {
          pagination.style.display = 'none';
        }
      }, index * 100); // Stagger the animation
    });
    
    currentPage++;
  }

  function showViewMoreButton() {
    if (allReviews.length > reviewsPerPage) {
      pagination.style.display = 'block';
    }
  }

  // Event listener for view more button
  viewMoreBtn.addEventListener('click', function() {
    loadMoreReviews();
  });

  // Modal functionality
  const addReviewBtn = document.getElementById('add-review-btn-{{ ai_gen_id }}');
  const modalOverlay = document.getElementById('review-modal-overlay-{{ ai_gen_id }}');
  const modalClose = document.getElementById('review-modal-close-{{ ai_gen_id }}');
  const emojiOptions = document.querySelectorAll('.emoji-option-{{ ai_gen_id }}');
  const nextBtn = document.getElementById('review-next-btn-{{ ai_gen_id }}');
  const textarea = document.getElementById('review-textarea-{{ ai_gen_id }}');

  let selectedRating = 5; // Default to highest rating

  // Open modal
  addReviewBtn.addEventListener('click', function() {
    modalOverlay.classList.add('active');
    document.body.style.overflow = 'hidden'; // Prevent background scrolling
  });

  // Close modal
  function closeModal() {
    modalOverlay.classList.remove('active');
    document.body.style.overflow = 'auto'; // Restore scrolling
  }

  modalClose.addEventListener('click', closeModal);
  modalOverlay.addEventListener('click', function(e) {
    if (e.target === modalOverlay) {
      closeModal();
    }
  });

  // Emoji rating selection
  emojiOptions.forEach(option => {
    option.addEventListener('click', function() {
      // Remove selected class from all options
      emojiOptions.forEach(opt => opt.classList.remove('selected'));
      // Add selected class to clicked option
      this.classList.add('selected');
      selectedRating = parseInt(this.dataset.rating);
    });
  });

  // Page navigation elements
  const page1 = document.getElementById('review-page-1-{{ ai_gen_id }}');
  const page2 = document.getElementById('review-page-2-{{ ai_gen_id }}');
  const backBtn = document.getElementById('review-back-btn-{{ ai_gen_id }}');
  const submitBtn = document.getElementById('review-submit-btn-{{ ai_gen_id }}');
  const nameInput = document.getElementById('review-name-{{ ai_gen_id }}');
  const emailInput = document.getElementById('review-email-{{ ai_gen_id }}');
  const imageUpload = document.getElementById('image-upload-{{ ai_gen_id }}');
  const videoUpload = document.getElementById('video-upload-{{ ai_gen_id }}');
  const uploadImages = document.getElementById('upload-images-{{ ai_gen_id }}');
  const uploadVideo = document.getElementById('upload-video-{{ ai_gen_id }}');

  // Next button functionality - go to page 2
  nextBtn.addEventListener('click', function() {
    const reviewText = textarea.value.trim();
    
    if (reviewText === '') {
      alert('Please share your experience before proceeding.');
      return;
    }

    // Hide page 1, show page 2
    page1.style.display = 'none';
    page2.style.display = 'block';
  });

  // Back button functionality - go to page 1
  backBtn.addEventListener('click', function() {
    page2.style.display = 'none';
    page1.style.display = 'block';
  });

  // Upload functionality
  uploadImages.addEventListener('click', function() {
    imageUpload.click();
  });

  uploadVideo.addEventListener('click', function() {
    videoUpload.click();
  });

  // Handle file uploads
  imageUpload.addEventListener('change', function(e) {
    const files = e.target.files;
    if (files.length > 5) {
      alert('You can upload maximum 5 images.');
      return;
    }
    console.log('Images selected:', files.length);
  });

  videoUpload.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file && file.size > 50 * 1024 * 1024) { // 50MB limit
      alert('Video file size must be less than 50MB.');
      return;
    }
    console.log('Video selected:', file ? file.name : 'none');
  });

  // Submit button functionality
  submitBtn.addEventListener('click', function() {
    const name = nameInput.value.trim();
    const email = emailInput.value.trim();
    const reviewText = textarea.value.trim();
    
    if (name === '') {
      alert('Please enter your name.');
      nameInput.focus();
      return;
    }
    
    if (email === '') {
      alert('Please enter your email.');
      emailInput.focus();
      return;
    }
    
    if (!isValidEmail(email)) {
      alert('Please enter a valid email address.');
      emailInput.focus();
      return;
    }

    // Here you can add the logic to submit the review
    console.log('Review submitted:', {
      rating: selectedRating,
      text: reviewText,
      name: name,
      email: email,
      images: imageUpload.files,
      video: videoUpload.files[0]
    });

    // Show success message
    alert('Thank you for your review! You will receive 60 points.');
    
    // Close modal and reset form
    closeModal();
    resetForm();
  });

  // Email validation function
  function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  // Reset form function
  function resetForm() {
    textarea.value = '';
    nameInput.value = '';
    emailInput.value = '';
    imageUpload.value = '';
    videoUpload.value = '';
    selectedRating = 5;
    emojiOptions.forEach(opt => opt.classList.remove('selected'));
    emojiOptions[4].classList.add('selected'); // Reset to highest rating
    page2.style.display = 'none';
    page1.style.display = 'block';
  }

  // Initialize
  initializeColumns();
  loadMoreReviews(); // Load first 8 reviews
  showViewMoreButton(); // Show button if there are more reviews
});
</script>

{% schema %}
{
  "name": "Reviews Section",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Customer Reviews"
    },
    {
      "type": "text",
      "id": "section_subtitle",
      "label": "Section Subtitle",
      "default": "See what our customers are saying about our products"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#f8f9fa"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Subtitle Color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "name_color",
      "label": "Name Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "comment_color",
      "label": "Comment Color",
      "default": "#666666"
    },
    {
      "type": "header",
      "content": "Review 1"
    },
    {
      "type": "image_picker",
      "id": "review_1_image",
      "label": "Review 1 Image"
    },
    {
      "type": "text",
      "id": "review_1_name",
      "label": "Review 1 Name",
      "default": "Sarah Johnson"
    },
    {
      "type": "range",
      "id": "review_1_stars",
      "label": "Review 1 Stars",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 5
    },
    {
      "type": "textarea",
      "id": "review_1_comment",
      "label": "Review 1 Comment",
      "default": "Amazing product! Exceeded my expectations. Highly recommend to everyone."
    },
    {
      "type": "text",
      "id": "review_1_date",
      "label": "Review 1 Date",
      "default": "2 days ago"
    },
    {
      "type": "header",
      "content": "Review 2"
    },
    {
      "type": "image_picker",
      "id": "review_2_image",
      "label": "Review 2 Image"
    },
    {
      "type": "text",
      "id": "review_2_name",
      "label": "Review 2 Name",
      "default": "Mike Chen"
    },
    {
      "type": "range",
      "id": "review_2_stars",
      "label": "Review 2 Stars",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 4
    },
    {
      "type": "textarea",
      "id": "review_2_comment",
      "label": "Review 2 Comment",
      "default": "Great quality and fast shipping. Will definitely order again."
    },
    {
      "type": "text",
      "id": "review_2_date",
      "label": "Review 2 Date",
      "default": "1 week ago"
    },
    {
      "type": "header",
      "content": "Review 3"
    },
    {
      "type": "image_picker",
      "id": "review_3_image",
      "label": "Review 3 Image"
    },
    {
      "type": "text",
      "id": "review_3_name",
      "label": "Review 3 Name",
      "default": "Emily Davis"
    },
    {
      "type": "range",
      "id": "review_3_stars",
      "label": "Review 3 Stars",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 5
    },
    {
      "type": "textarea",
      "id": "review_3_comment",
      "label": "Review 3 Comment",
      "default": "Perfect! Exactly what I was looking for. Customer service was excellent too."
    },
    {
      "type": "text",
      "id": "review_3_date",
      "label": "Review 3 Date",
      "default": "3 days ago"
    },
    {
      "type": "header",
      "content": "Review 4"
    },
    {
      "type": "image_picker",
      "id": "review_4_image",
      "label": "Review 4 Image"
    },
    {
      "type": "text",
      "id": "review_4_name",
      "label": "Review 4 Name",
      "default": "David Wilson"
    },
    {
      "type": "range",
      "id": "review_4_stars",
      "label": "Review 4 Stars",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 3
    },
    {
      "type": "textarea",
      "id": "review_4_comment",
      "label": "Review 4 Comment",
      "default": "Good product overall, but could be better."
    },
    {
      "type": "text",
      "id": "review_4_date",
      "label": "Review 4 Date",
      "default": "5 days ago"
    },
    {
      "type": "header",
      "content": "Review 5"
    },
    {
      "type": "image_picker",
      "id": "review_5_image",
      "label": "Review 5 Image"
    },
    {
      "type": "text",
      "id": "review_5_name",
      "label": "Review 5 Name",
      "default": "Lisa Brown"
    },
    {
      "type": "range",
      "id": "review_5_stars",
      "label": "Review 5 Stars",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 5
    },
    {
      "type": "textarea",
      "id": "review_5_comment",
      "label": "Review 5 Comment",
      "default": "Outstanding quality and value for money. Very satisfied with my purchase."
    },
    {
      "type": "text",
      "id": "review_5_date",
      "label": "Review 5 Date",
      "default": "1 week ago"
    },
    {
      "type": "header",
      "content": "Review 6"
    },
    {
      "type": "image_picker",
      "id": "review_6_image",
      "label": "Review 6 Image"
    },
    {
      "type": "text",
      "id": "review_6_name",
      "label": "Review 6 Name",
      "default": "Alex Rodriguez"
    },
    {
      "type": "range",
      "id": "review_6_stars",
      "label": "Review 6 Stars",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 4
    },
    {
      "type": "textarea",
      "id": "review_6_comment",
      "label": "Review 6 Comment",
      "default": "Fast delivery and good packaging. Product works as described."
    },
    {
      "type": "text",
      "id": "review_6_date",
      "label": "Review 6 Date",
      "default": "4 days ago"
    },
    {
      "type": "header",
      "content": "Review 7"
    },
    {
      "type": "image_picker",
      "id": "review_7_image",
      "label": "Review 7 Image"
    },
    {
      "type": "text",
      "id": "review_7_name",
      "label": "Review 7 Name",
      "default": "Maria Garcia"
    },
    {
      "type": "range",
      "id": "review_7_stars",
      "label": "Review 7 Stars",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 5
    },
    {
      "type": "textarea",
      "id": "review_7_comment",
      "label": "Review 7 Comment",
      "default": "Love it! Will definitely buy again. Great customer service."
    },
    {
      "type": "text",
      "id": "review_7_date",
      "label": "Review 7 Date",
      "default": "6 days ago"
    },
    {
      "type": "header",
      "content": "Review 8"
    },
    {
      "type": "image_picker",
      "id": "review_8_image",
      "label": "Review 8 Image"
    },
    {
      "type": "text",
      "id": "review_8_name",
      "label": "Review 8 Name",
      "default": "John Smith"
    },
    {
      "type": "range",
      "id": "review_8_stars",
      "label": "Review 8 Stars",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 4
    },
    {
      "type": "textarea",
      "id": "review_8_comment",
      "label": "Review 8 Comment",
      "default": "Good product, arrived on time. Happy with the purchase."
    },
    {
      "type": "text",
      "id": "review_8_date",
      "label": "Review 8 Date",
      "default": "2 weeks ago"
    }
  ],
  "presets": [
    {
      "name": "Reviews Section"
    }
  ]
}
{% endschema %}
