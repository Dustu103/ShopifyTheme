{% comment %}
  AI Generated Block: Reviews Section
  Features: Masonry layout with 4 columns, dynamic card placement
{% endcomment %}

{%- assign ai_gen_id = block.id | slice: -8 -%}

<div class="reviews-section-{{ ai_gen_id }}">
  <div class="reviews-container-{{ ai_gen_id }}">
    {% if block.settings.section_title != blank %}
      <h2 class="reviews-title-{{ ai_gen_id }}">{{ block.settings.section_title }}</h2>
    {% endif %}
    
    {% if block.settings.section_subtitle != blank %}
      <p class="reviews-subtitle-{{ ai_gen_id }}">{{ block.settings.section_subtitle }}</p>
    {% endif %}
    
    <div class="reviews-grid-{{ ai_gen_id }}" id="reviews-grid-{{ ai_gen_id }}">
      <!-- Reviews will be dynamically added here by JavaScript -->
    </div>
    
    <div class="reviews-pagination-{{ ai_gen_id }}" id="reviews-pagination-{{ ai_gen_id }}" style="display: none;">
      <button class="view-more-btn-{{ ai_gen_id }}" id="view-more-btn-{{ ai_gen_id }}">
        View More Reviews
      </button>
    </div>
  </div>
</div>

{% style %}
  .reviews-section-{{ ai_gen_id }} {
    background-color: {{ block.settings.background_color | default: '#f8f9fa' }};
    padding: 4rem 0;
  }

  .reviews-container-{{ ai_gen_id }} {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
  }

  .reviews-title-{{ ai_gen_id }} {
    font-size: 2.5rem;
    font-weight: 700;
    color: {{ block.settings.title_color | default: '#333' }};
    text-align: center;
    margin-bottom: 1rem;
  }

  .reviews-subtitle-{{ ai_gen_id }} {
    font-size: 1.1rem;
    color: {{ block.settings.subtitle_color | default: '#666' }};
    text-align: center;
    max-width: 600px;
    margin: 0 auto 3rem auto;
  }

  .reviews-grid-{{ ai_gen_id }} {
    display: flex;
    gap: 1.5rem;
    align-items: flex-start;
  }

  .reviews-column-{{ ai_gen_id }} {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .review-card-{{ ai_gen_id }} {
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    break-inside: avoid;
    margin-bottom: 1.5rem;
    display: flex;
    flex-direction: column;
  }

  .review-card-{{ ai_gen_id }}:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  }

  .review-product-image-{{ ai_gen_id }} {
    width: 100%;
    height: 200px;
    object-fit: cover;
  }

  .review-content-{{ ai_gen_id }} {
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .review-card-no-image-{{ ai_gen_id }} .review-content-{{ ai_gen_id }} {
    padding: 1.5rem;
  }

  .review-name-{{ ai_gen_id }} {
    font-size: 1rem;
    font-weight: 600;
    color: {{ block.settings.name_color | default: '#333' }};
    margin: 0;
    text-transform: capitalize;
  }

  .review-stars-{{ ai_gen_id }} {
    display: flex;
    gap: 2px;
    margin: 0;
  }

  .review-star-{{ ai_gen_id }} {
    width: 16px;
    height: 16px;
    fill: #e32402;
  }

  .review-star-empty-{{ ai_gen_id }} {
    width: 16px;
    height: 16px;
    fill: none;
    stroke: #ddd;
    stroke-width: 1.5;
  }

  .review-comment-{{ ai_gen_id }} {
    color: {{ block.settings.comment_color | default: '#333' }};
    line-height: 1.5;
    margin: 0;
    font-size: 0.9rem;
  }

  .review-date-{{ ai_gen_id }} {
    font-size: 0.85rem;
    color: #999;
    margin: 0;
  }

  .reviews-pagination-{{ ai_gen_id }} {
    text-align: center;
    margin-top: 3rem;
  }

  .view-more-btn-{{ ai_gen_id }} {
    background: #e32402;
    color: white;
    border: none;
    padding: 12px 30px;
    border-radius: 25px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .view-more-btn-{{ ai_gen_id }}:hover {
    background: #c01e02;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(227, 36, 2, 0.3);
  }

  .view-more-btn-{{ ai_gen_id }}:active {
    transform: translateY(0);
  }

  /* Responsive Design */
  @media (max-width: 1024px) {
    .reviews-grid-{{ ai_gen_id }} {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (max-width: 768px) {
    .reviews-section-{{ ai_gen_id }} {
      padding: 3rem 0;
    }
    
    .reviews-container-{{ ai_gen_id }} {
      padding: 0 1rem;
    }
    
    .reviews-title-{{ ai_gen_id }} {
      font-size: 2rem;
    }
    
    .reviews-grid-{{ ai_gen_id }} {
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }
  }

  @media (max-width: 480px) {
    .reviews-grid-{{ ai_gen_id }} {
      grid-template-columns: 1fr;
    }
    
    .review-card-{{ ai_gen_id }} {
      padding: 1rem;
    }
  }
{% endstyle %}

<script>
document.addEventListener('DOMContentLoaded', function() {
  const grid = document.getElementById('reviews-grid-{{ ai_gen_id }}');
  const pagination = document.getElementById('reviews-pagination-{{ ai_gen_id }}');
  const viewMoreBtn = document.getElementById('view-more-btn-{{ ai_gen_id }}');
  
  if (!grid) return;

  // Review data from block settings
  const allReviews = [
    {% if block.settings.review_1_name != blank %}
    {
      name: "{{ block.settings.review_1_name }}",
      stars: {{ block.settings.review_1_stars | default: 5 }},
      comment: "{{ block.settings.review_1_comment }}",
      date: "{{ block.settings.review_1_date }}",
      image: "{{ block.settings.review_1_image  }}"
    },
    {% endif %}
    {% if block.settings.review_2_name != blank %}
    {
      name: "{{ block.settings.review_2_name }}",
      stars: {{ block.settings.review_2_stars | default: 5 }},
      comment: "{{ block.settings.review_2_comment }}",
      date: "{{ block.settings.review_2_date }}",
      image: "{{ block.settings.review_2_image  }}"
    },
    {% endif %}
    {% if block.settings.review_3_name != blank %}
    {
      name: "{{ block.settings.review_3_name }}",
      stars: {{ block.settings.review_3_stars | default: 5 }},
      comment: "{{ block.settings.review_3_comment }}",
      date: "{{ block.settings.review_3_date }}",
      image: "{{ block.settings.review_3_image  }}"
    },
    {% endif %}
    {% if block.settings.review_4_name != blank %}
    {
      name: "{{ block.settings.review_4_name }}",
      stars: {{ block.settings.review_4_stars | default: 5 }},
      comment: "{{ block.settings.review_4_comment }}",
      date: "{{ block.settings.review_4_date }}",
      image: "{{ block.settings.review_4_image  }}"
    },
    {% endif %}
    {% if block.settings.review_5_name != blank %}
    {
      name: "{{ block.settings.review_5_name }}",
      stars: {{ block.settings.review_5_stars | default: 5 }},
      comment: "{{ block.settings.review_5_comment }}",
      date: "{{ block.settings.review_5_date }}",
      image: "{% if block.settings.review_5_image != blank %}{{ block.settings.review_5_image  }}{% else %}https://cdn.nector.io/?image=https://cdn.nector.io/nector-static/system-upload/c04b9fac-06aa-4172-918c-167503bbe118.jpeg&quality=25{% endif %}"
    },
    {% endif %}
    {% if block.settings.review_6_name != blank %}
    {
      name: "{{ block.settings.review_6_name }}",
      stars: {{ block.settings.review_6_stars | default: 5 }},
      comment: "{{ block.settings.review_6_comment }}",
      date: "{{ block.settings.review_6_date }}",
      image: "{{ block.settings.review_6_image  }}"
    },
    {% endif %}
    {% if block.settings.review_7_name != blank %}
    {
      name: "{{ block.settings.review_7_name }}",
      stars: {{ block.settings.review_7_stars | default: 5 }},
      comment: "{{ block.settings.review_7_comment }}",
      date: "{{ block.settings.review_7_date }}",
      image: "{{ block.settings.review_7_image  }}"
    },
    {% endif %}
    {% if block.settings.review_8_name != blank %}
    {
      name: "{{ block.settings.review_8_name }}",
      stars: {{ block.settings.review_8_stars | default: 5 }},
      comment: "{{ block.settings.review_8_comment }}",
      date: "{{ block.settings.review_8_date }}",
      image: "{{ block.settings.review_8_image  }}"
    },
    {% endif %}
    {% if block.settings.review_8_name != blank %}
    {
      name: "{{ block.settings.review_8_name }}",
      stars: {{ block.settings.review_8_stars | default: 5 }},
      comment: "{{ block.settings.review_8_comment }}",
      date: "{{ block.settings.review_8_date }}",
      image: "{{ block.settings.review_8_image  }}"
    },
    {% endif %}
  ].filter(review => review.name); // Remove empty reviews

  // Pagination variables
  const reviewsPerPage = 8;
  let currentPage = 0;
  let displayedReviews = 0;

  function createReviewCard(review) {
    const card = document.createElement('div');
    card.className = `review-card-{{ ai_gen_id }}${!review.image ? ' review-card-no-image-{{ ai_gen_id }}' : ''}`;
    
    let starsHtml = '';
    for (let i = 0; i < 5; i++) {
      if (i < review.stars) {
        starsHtml += `<svg class="review-star-{{ ai_gen_id }}" viewBox="0 0 24 24">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>`;
      } else {
        starsHtml += `<svg class="review-star-empty-{{ ai_gen_id }}" viewBox="0 0 24 24">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>`;
      }
    }
    
    card.innerHTML = `
      ${review.image ? `<img src="${review.image}" alt="Product" class="review-product-image-{{ ai_gen_id }}">` : ''}
      <div class="review-content-{{ ai_gen_id }}">
        <h4 class="review-name-{{ ai_gen_id }}">${review.name}</h4>
        <div class="review-stars-{{ ai_gen_id }}">${starsHtml}</div>
        ${review.comment ? `<p class="review-comment-{{ ai_gen_id }}">${review.comment}</p>` : ''}
        ${review.date ? `<div class="review-date-{{ ai_gen_id }}">${review.date}</div>` : ''}
      </div>
    `;
    
    return card;
  }

  function initializeColumns() {
    // Create 4 columns
    for (let i = 0; i < 4; i++) {
      const column = document.createElement('div');
      column.className = 'reviews-column-{{ ai_gen_id }}';
      grid.appendChild(column);
    }
  }

  function getColumnHeights() {
    const columns = grid.children;
    const heights = [];
    for (let i = 0; i < columns.length; i++) {
      heights.push(columns[i].offsetHeight);
    }
    return heights;
  }

  function addReviewToShortestColumn(review) {
    const card = createReviewCard(review);
    
    // Find the column with minimum height
    const heights = getColumnHeights();
    const minHeight = Math.min(...heights);
    const minIndex = heights.indexOf(minHeight);
    
    // Add card to the shortest column
    grid.children[minIndex].appendChild(card);
  }

  function loadMoreReviews() {
    const startIndex = currentPage * reviewsPerPage;
    const endIndex = Math.min(startIndex + reviewsPerPage, allReviews.length);
    const reviewsToShow = allReviews.slice(startIndex, endIndex);
    
    reviewsToShow.forEach((review, index) => {
      setTimeout(() => {
        addReviewToShortestColumn(review);
        displayedReviews++;
        
        // Check if this was the last review to be added
        if (displayedReviews >= allReviews.length) {
          pagination.style.display = 'none';
        }
      }, index * 100); // Stagger the animation
    });
    
    currentPage++;
  }

  function showViewMoreButton() {
    if (allReviews.length > reviewsPerPage) {
      pagination.style.display = 'block';
    }
  }

  // Event listener for view more button
  viewMoreBtn.addEventListener('click', function() {
    loadMoreReviews();
  });

  // Initialize
  initializeColumns();
  loadMoreReviews(); // Load first 8 reviews
  showViewMoreButton(); // Show button if there are more reviews
});
</script>

{% schema %}
{
  "name": "Reviews Section",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Customer Reviews"
    },
    {
      "type": "text",
      "id": "section_subtitle",
      "label": "Section Subtitle",
      "default": "See what our customers are saying about our products"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#f8f9fa"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Subtitle Color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "name_color",
      "label": "Name Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "comment_color",
      "label": "Comment Color",
      "default": "#666666"
    },
    {
      "type": "header",
      "content": "Review 1"
    },
    {
      "type": "image_picker",
      "id": "review_1_image",
      "label": "Review 1 Image"
    },
    {
      "type": "text",
      "id": "review_1_name",
      "label": "Review 1 Name",
      "default": "Sarah Johnson"
    },
    {
      "type": "range",
      "id": "review_1_stars",
      "label": "Review 1 Stars",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 5
    },
    {
      "type": "textarea",
      "id": "review_1_comment",
      "label": "Review 1 Comment",
      "default": "Amazing product! Exceeded my expectations. Highly recommend to everyone."
    },
    {
      "type": "text",
      "id": "review_1_date",
      "label": "Review 1 Date",
      "default": "2 days ago"
    },
    {
      "type": "header",
      "content": "Review 2"
    },
    {
      "type": "image_picker",
      "id": "review_2_image",
      "label": "Review 2 Image"
    },
    {
      "type": "text",
      "id": "review_2_name",
      "label": "Review 2 Name",
      "default": "Mike Chen"
    },
    {
      "type": "range",
      "id": "review_2_stars",
      "label": "Review 2 Stars",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 4
    },
    {
      "type": "textarea",
      "id": "review_2_comment",
      "label": "Review 2 Comment",
      "default": "Great quality and fast shipping. Will definitely order again."
    },
    {
      "type": "text",
      "id": "review_2_date",
      "label": "Review 2 Date",
      "default": "1 week ago"
    },
    {
      "type": "header",
      "content": "Review 3"
    },
    {
      "type": "image_picker",
      "id": "review_3_image",
      "label": "Review 3 Image"
    },
    {
      "type": "text",
      "id": "review_3_name",
      "label": "Review 3 Name",
      "default": "Emily Davis"
    },
    {
      "type": "range",
      "id": "review_3_stars",
      "label": "Review 3 Stars",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 5
    },
    {
      "type": "textarea",
      "id": "review_3_comment",
      "label": "Review 3 Comment",
      "default": "Perfect! Exactly what I was looking for. Customer service was excellent too."
    },
    {
      "type": "text",
      "id": "review_3_date",
      "label": "Review 3 Date",
      "default": "3 days ago"
    },
    {
      "type": "header",
      "content": "Review 4"
    },
    {
      "type": "image_picker",
      "id": "review_4_image",
      "label": "Review 4 Image"
    },
    {
      "type": "text",
      "id": "review_4_name",
      "label": "Review 4 Name",
      "default": "David Wilson"
    },
    {
      "type": "range",
      "id": "review_4_stars",
      "label": "Review 4 Stars",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 3
    },
    {
      "type": "textarea",
      "id": "review_4_comment",
      "label": "Review 4 Comment",
      "default": "Good product overall, but could be better."
    },
    {
      "type": "text",
      "id": "review_4_date",
      "label": "Review 4 Date",
      "default": "5 days ago"
    },
    {
      "type": "header",
      "content": "Review 5"
    },
    {
      "type": "image_picker",
      "id": "review_5_image",
      "label": "Review 5 Image"
    },
    {
      "type": "text",
      "id": "review_5_name",
      "label": "Review 5 Name",
      "default": "Lisa Brown"
    },
    {
      "type": "range",
      "id": "review_5_stars",
      "label": "Review 5 Stars",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 5
    },
    {
      "type": "textarea",
      "id": "review_5_comment",
      "label": "Review 5 Comment",
      "default": "Outstanding quality and value for money. Very satisfied with my purchase."
    },
    {
      "type": "text",
      "id": "review_5_date",
      "label": "Review 5 Date",
      "default": "1 week ago"
    },
    {
      "type": "header",
      "content": "Review 6"
    },
    {
      "type": "image_picker",
      "id": "review_6_image",
      "label": "Review 6 Image"
    },
    {
      "type": "text",
      "id": "review_6_name",
      "label": "Review 6 Name",
      "default": "Alex Rodriguez"
    },
    {
      "type": "range",
      "id": "review_6_stars",
      "label": "Review 6 Stars",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 4
    },
    {
      "type": "textarea",
      "id": "review_6_comment",
      "label": "Review 6 Comment",
      "default": "Fast delivery and good packaging. Product works as described."
    },
    {
      "type": "text",
      "id": "review_6_date",
      "label": "Review 6 Date",
      "default": "4 days ago"
    },
    {
      "type": "header",
      "content": "Review 7"
    },
    {
      "type": "image_picker",
      "id": "review_7_image",
      "label": "Review 7 Image"
    },
    {
      "type": "text",
      "id": "review_7_name",
      "label": "Review 7 Name",
      "default": "Maria Garcia"
    },
    {
      "type": "range",
      "id": "review_7_stars",
      "label": "Review 7 Stars",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 5
    },
    {
      "type": "textarea",
      "id": "review_7_comment",
      "label": "Review 7 Comment",
      "default": "Love it! Will definitely buy again. Great customer service."
    },
    {
      "type": "text",
      "id": "review_7_date",
      "label": "Review 7 Date",
      "default": "6 days ago"
    },
    {
      "type": "header",
      "content": "Review 8"
    },
    {
      "type": "image_picker",
      "id": "review_8_image",
      "label": "Review 8 Image"
    },
    {
      "type": "text",
      "id": "review_8_name",
      "label": "Review 8 Name",
      "default": "John Smith"
    },
    {
      "type": "range",
      "id": "review_8_stars",
      "label": "Review 8 Stars",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 4
    },
    {
      "type": "textarea",
      "id": "review_8_comment",
      "label": "Review 8 Comment",
      "default": "Good product, arrived on time. Happy with the purchase."
    },
    {
      "type": "text",
      "id": "review_8_date",
      "label": "Review 8 Date",
      "default": "2 weeks ago"
    }
  ],
  "presets": [
    {
      "name": "Reviews Section"
    }
  ]
}
{% endschema %}
